{% extends "main.html" %}

{% block extrahead %}
  <style>
    .md-header {
      background-color: transparent !important;
      box-shadow: none !important;
      transition: background-color 250ms;
    }
    .md-header[data-md-state="shadow"] {
      background-color: var(--md-primary-fg-color) !important;
      box-shadow: 0 0 0.4rem rgba(0,0,0,0.1), 0 0.4rem 0.8rem rgba(0,0,0,0.2) !important;
    }
    /* Ensure header elements are white when transparent */
    .md-header:not([data-md-state="shadow"]) .md-header__button,
    .md-header:not([data-md-state="shadow"]) .md-header__title,
    .md-header:not([data-md-state="shadow"]) .md-nav__link {
      color: white !important;
    }
    .md-tabs {
      background-color: transparent !important;
      transition: background-color 250ms;
    }
    .md-tabs[data-md-state="shadow"] {
      background-color: var(--md-primary-fg-color) !important;
    }
    .md-tabs:not([data-md-state="shadow"]) .md-tabs__link {
      color: white !important;
    }
    .md-tabs:not([data-md-state="shadow"]) .md-tabs__link--active {
      color: white !important;
      font-weight: 700;
    }
    .md-main {
      background-color: var(--md-default-bg-color);
      position: relative;
      z-index: 1;
    }
    #procedural-bg-container {
      margin-top: -4.8rem;
      background-color: #050505;
    }
    @media screen and (max-width: 76.1875em) {
      #procedural-bg-container {
        margin-top: -2.4rem;
      }
    }
  </style>
{% endblock %}
{% block tabs %}
  {{ super() }}

  <div id="procedural-bg-container" style="position: relative; height: 100vh; width: 100%; overflow: hidden;">
    <canvas id="procedural-canvas" style="display: block; width: 100%; height: 100%;"></canvas>
    
    <div style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; display: flex; flex-direction: column; justify-content: center; align-items: center; pointer-events: none;">
        <div style="text-align: center; pointer-events: auto;">

              <a href="https://nl.linkedin.com/in/timvink"
                title="public Linkedin profile of Tim Vink">
                <span class="twemoji homepage_icon">
                  {% include ".icons/fontawesome/brands/linkedin.svg" %} 
                </span>
              </a>

              <a href="http://github.com/timvink" title = "github profile of Tim Vink">
                <span class="twemoji homepage_icon">
                  {% include ".icons/fontawesome/brands/github.svg" %} 
                </span>
              </a>

              <a href="http://gitlab.com/vinktim" title="gitlab profile of Tim Vink">
                <span class="twemoji homepage_icon">
                  {% include ".icons/fontawesome/brands/square-gitlab.svg" %} 
                </span>
              </a>

              <a href="https://twitter.com/timvink" title="twitter profile of Tim Vink">
                  <span class="twemoji homepage_icon">
                    {% include ".icons/fontawesome/brands/twitter.svg" %} 
                  </span>
              </a>

              <a  href="https://stackoverflow.com/users/5525118/timvink" title="Stackoverflow profile of Tim Vink">
                <span class="twemoji homepage_icon">
                  {% include ".icons/fontawesome/brands/stack-overflow.svg" %} 
                </span>
              </a>

            <h1 style="color: white; font-weight: 300; letter-spacing: 0.1em; margin-top: 2rem; padding: 0 1rem;">
              Hi! I'm Tim, a data-literate digital-native that loves space.
            </h1>

        </div>

        <div style="position: absolute; bottom: 2rem; width: 100%; text-align: center; pointer-events: auto;">
            <a href="#start-blog-entries-overview" title="Scroll down">
              <span class="twemoji homepage_icon homepage_arrow" style="width: 2rem">
                {% include ".icons/octicons/chevron-down-24.svg" %} 
              </span>
            </a>
        </div>
    </div>
  </div>

  <script type="module">
    import * as THREE from 'https://unpkg.com/three@0.160.0/build/three.module.js';

    const container = document.getElementById('procedural-bg-container');
    const canvas = document.getElementById('procedural-canvas');

    const scene = new THREE.Scene();
    scene.fog = new THREE.FogExp2(0x050505, 0.002);

    const camera = new THREE.PerspectiveCamera(75, container.clientWidth / container.clientHeight, 0.1, 1000);
    camera.position.z = 50;

    const renderer = new THREE.WebGLRenderer({ canvas: canvas, antialias: true, alpha: true });
    renderer.setSize(container.clientWidth, container.clientHeight);
    renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));

    const particleCount = 2000;
    const geometry = new THREE.BufferGeometry();
    const positions = new Float32Array(particleCount * 3);
    const sizes = new Float32Array(particleCount);
    const speeds = new Float32Array(particleCount);
    const offsets = new Float32Array(particleCount);

    for (let i = 0; i < particleCount; i++) {
        positions[i * 3] = (Math.random() - 0.5) * 200;
        positions[i * 3 + 1] = (Math.random() - 0.5) * 100;
        positions[i * 3 + 2] = (Math.random() - 0.5) * 100;

        sizes[i] = Math.random() * 2;
        speeds[i] = 0.2 + Math.random() * 0.8;
        offsets[i] = Math.random() * Math.PI * 2;
    }

    geometry.setAttribute('position', new THREE.BufferAttribute(positions, 3));
    geometry.setAttribute('size', new THREE.BufferAttribute(sizes, 1));

    const material = new THREE.ShaderMaterial({
        uniforms: {
            color: { value: new THREE.Color(0xaaccff) },
            time: { value: 0 }
        },
        vertexShader: `
            attribute float size;
            varying float vOpacity;
            void main() {
                vec4 mvPosition = modelViewMatrix * vec4(position, 1.0);
                gl_PointSize = size * (300.0 / -mvPosition.z);
                gl_Position = projectionMatrix * mvPosition;
                vOpacity = 1.0 - ((-mvPosition.z) / 100.0); 
            }
        `,
        fragmentShader: `
            uniform vec3 color;
            varying float vOpacity;
            void main() {
                float r = distance(gl_PointCoord, vec2(0.5, 0.5));
                if (r > 0.5) discard;
                float glow = 1.0 - (r * 2.0);
                glow = pow(glow, 1.5); 
                gl_FragColor = vec4(color, glow * vOpacity * 0.8); 
            }
        `,
        transparent: true,
        depthWrite: false,
        blending: THREE.AdditiveBlending
    });

    const particles = new THREE.Points(geometry, material);
    scene.add(particles);

    let time = 0;
    const clock = new THREE.Clock();
    
    let mouseX = 0;
    let mouseY = 0;
    let targetX = 0;
    let targetY = 0;

    window.addEventListener('mousemove', (e) => {
        mouseX = (e.clientX - window.innerWidth / 2) * 0.05;
        mouseY = (e.clientY - window.innerHeight / 2) * 0.05;
    });

    function animate() {
        requestAnimationFrame(animate);

        const delta = clock.getDelta();
        time += delta * 0.2;

        material.uniforms.time.value = time;

        targetX = mouseX * 0.5;
        targetY = mouseY * 0.5;
        camera.position.x += (targetX - camera.position.x) * 0.05;
        camera.position.y += (-targetY - camera.position.y) * 0.05;
        camera.lookAt(scene.position);

        const positions = particles.geometry.attributes.position.array;
        
        for (let i = 0; i < particleCount; i++) {
            const i3 = i * 3;
            positions[i3] += Math.sin(time + offsets[i]) * 0.02 * speeds[i];
            positions[i3 + 1] += Math.cos(time * 0.5 + offsets[i]) * 0.02 * speeds[i];
            positions[i3 + 2] += 0.05 * speeds[i];

            if (positions[i3 + 2] > 40) {
                positions[i3 + 2] = -60;
                positions[i3] = (Math.random() - 0.5) * 200;
                positions[i3 + 1] = (Math.random() - 0.5) * 100;
            }
        }
        particles.geometry.attributes.position.needsUpdate = true;
        particles.rotation.z = time * 0.05;

        renderer.render(scene, camera);
    }

    animate();

    window.addEventListener('resize', () => {
        camera.aspect = container.clientWidth / container.clientHeight;
        camera.updateProjectionMatrix();
        renderer.setSize(container.clientWidth, container.clientHeight);
    });
  </script>
{% endblock %}

{% block content %}

  <div id="start-blog-entries-overview">
  </div>

  {% for post in blog_pages|reverse %}
  
  <article class="md-post md-post--excerpt" style="margin-bottom: 0.5rem;">
    <header class="md-post__header">
      <div class="md-post__meta md-meta">
        <time datetime="{{ post.config.date.created }}">
          {{- post.config.date.created | date -}}
        </time> - {{ post.config.readtime }} min read          
      </div>
    </header>

    <div class="md-post__content md-typeset">
      <h2><a class="toclink" href="{{ post.url }}">{{ post.title }}</a></h2>
    </div>

  </article>
    
  {% endfor %}

{% endblock %}


{% block footer %}
  {{ super() }}
{% endblock %}